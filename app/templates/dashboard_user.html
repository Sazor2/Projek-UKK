{% extends "base.html" %}

{% block title %}Dashboard Siswa{% endblock %}

{% block content %}
<div class="dashboard-container">
    <!-- Header Section -->
    <div class="dashboard-header mb-4">
        <div class="row align-items-center">
            <div class="col-md-8">
                <h2 class="welcome-text">Selamat Datang, {{ current_user.name }}</h2>
                <p class="text-muted">{{ "Silahkan lengkapi pendaftaran Anda" if not form_submitted else "Status pendaftaran Anda dapat dilihat di bawah" }}</p>
            </div>
            <div class="col-md-4 text-md-end">
                {% if form_status == 'accepted' %}
                    <div class="status-pill success">
                        <i class="fas fa-check-circle"></i> Diterima
                    </div>
                {% elif form_status == 'rejected' %}
                    <div class="status-pill danger">
                        <i class="fas fa-times-circle"></i> Tidak Diterima
                    </div>
                {% elif form_submitted %}
                    <div class="status-pill warning">
                        <i class="fas fa-clock"></i> Dalam Proses
                    </div>
                {% endif %}
            </div>
        </div>
    </div>

    <div class="row g-4">
        <!-- Left Column -->
        <div class="col-md-4">
            <div class="card profile-card">
                <div class="card-body">
                    <div class="profile-header">
                        <div class="profile-avatar">
                            <i class="fas fa-user-circle"></i>
                        </div>
                        <h4 class="profile-name">{{ current_user.name }}</h4>
                        {% if form_submitted %}
                            <span class="profile-id">NISN: {{ form_submitted.parsed_form_data.get('nisn') }}</span>
                        {% endif %}
                    </div>

                    {% if form_submitted %}
                        {% set form_data = form_submitted.parsed_form_data %}
                        <div class="profile-info">
                            <div class="info-item">
                                <i class="fas fa-calendar"></i>
                                <div>
                                    <label>Tanggal Lahir</label>
                                    <span>{{ form_data.get('birth_date') }}</span>
                                </div>
                            </div>
                            <div class="info-item">
                                <i class="fas fa-phone"></i>
                                <div>
                                    <label>Telepon</label>
                                    <span>{{ form_data.get('phone') }}</span>
                                </div>
                            </div>
                            <div class="info-item">
                                <i class="fas fa-school"></i>
                                <div>
                                    <label>Asal Sekolah</label>
                                    <span>{{ form_data.get('previous_school') }}</span>
                                </div>
                            </div>
                            <div class="info-item">
                                <i class="fas fa-map-marker-alt"></i>
                                <div>
                                    <label>Alamat</label>
                                    <span>{{ form_data.get('address') }}</span>
                                </div>
                            </div>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Right Column -->
        <div class="col-md-8">
            {% if form_submitted %}
                <div class="card">
                    <div class="card-body">
                        <h4 class="card-title mb-4">Progress Pendaftaran</h4>
                        
                        <div class="timeline">
                            <div class="timeline-item completed">
                                <div class="timeline-dot">
                                    <i class="fas fa-check"></i>
                                </div>
                                <div class="timeline-content">
                                    <h5>Pendaftaran</h5>
                                    <p>Form telah disubmit pada {{ form_submitted.timestamp.strftime('%d %B %Y') }}</p>
                                </div>
                            </div>

                            <div class="timeline-item {{ 'completed' if form_status in ['accepted', 'rejected'] else 'active' }}">
                                <div class="timeline-dot">
                                    {% if form_status in ['accepted', 'rejected'] %}
                                        <i class="fas fa-check"></i>
                                    {% else %}
                                        <i class="fas fa-spinner fa-spin"></i>
                                    {% endif %}
                                </div>
                                <div class="timeline-content">
                                    <h5>Verifikasi</h5>
                                    <p>{{ "Sedang dalam proses verifikasi" if form_status == 'pending' else "Verifikasi selesai" }}</p>
                                </div>
                            </div>

                            <div class="timeline-item {{ 'completed' if form_status == 'accepted' else 'active' if form_status == 'rejected' else '' }}">
                                <div class="timeline-dot">
                                    {% if form_status == 'accepted' %}
                                        <i class="fas fa-check"></i>
                                    {% elif form_status == 'rejected' %}
                                        <i class="fas fa-times"></i>
                                    {% else %}
                                        <i class="fas fa-clock"></i>
                                    {% endif %}
                                </div>
                                <div class="timeline-content">
                                    <h5>Hasil</h5>
                                    {% if form_status == 'accepted' %}
                                        <div class="result-box success">
                                            <i class="fas fa-check-circle"></i>
                                            <p>Selamat! Anda diterima sebagai siswa baru</p>
                                            <a href="#" class="btn btn-success btn-sm mt-2">
                                                <i class="fas fa-print me-1"></i> Cetak Bukti Penerimaan
                                            </a>
                                        </div>
                                    {% elif form_status == 'rejected' %}
                                        <div class="result-box danger">
                                            <i class="fas fa-times-circle"></i>
                                            <p>Maaf, Anda belum dapat diterima</p>
                                        </div>
                                    {% else %}
                                        <p>Menunggu hasil keputusan</p>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            {% else %}
                <!-- Form Pendaftaran -->
                <div class="card">
                    <div class="card-body">
                        <h4 class="card-title mb-4">Formulir Pendaftaran</h4>
                        <!-- Your existing form code -->
                    </div>
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}